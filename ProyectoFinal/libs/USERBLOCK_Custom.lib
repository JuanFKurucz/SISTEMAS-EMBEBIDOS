/*** BeginHeader USERBLOCK_main */
void USERBLOCK_main(void *data);
/*** EndHeader */
void USERBLOCK_main(void *data){
	CheckPoint cp;
	int i;
	while(1){
		USERBLOCK_load(&storedInfo);
		OSTimeDlySec(15);
	}
}

/*** BeginHeader USERBLOCK_generateCheckSum */
int USERBLOCK_generateCheckSum(Info * info);
/*** EndHeader */
int USERBLOCK_generateCheckSum(Info * info){
	int result;
	int largoLista;
	CheckPoint tmp;
	CheckPoint * lista;
	char floatChar[25];
	int i;
	lista = (*info).checkpoints;
	largoLista = sizeof(lista)/sizeof(tmp);
	for (i = 0; i < largoLista; ++i){
		memset(floatChar,0,sizeof(floatChar));
		ftoa((*lista).longitud,floatChar);
		result += (unsigned int)floatChar;
		memset(floatChar,0,sizeof(floatChar));
		ftoa((*lista).latitud,floatChar);
		result += (unsigned int)floatChar;
		lista++;
	}
	return result;
}

/*** BeginHeader USERBLOCK_verify */
int USERBLOCK_verify(Info * info);
/*** EndHeader */
int USERBLOCK_verify(Info * info){
	if((*info).checksum == USERBLOCK_generateCheckSum(info)){
		return 1;
	}
	return 0;
}

/*** BeginHeader USERBLOCK_load */
void USERBLOCK_load(Info * info);
/*** EndHeader */
void USERBLOCK_load(Info * info){
	int r;
	memset(info,0,sizeof(info));
	r=readUserBlock(info,1,sizeof(info));
	if(!USERBLOCK_verify(info)){
		memset(info,0,sizeof(info));
		(*info).checkpoints = listaCheckPoints;
		(*info).checksum = USERBLOCK_generateCheckSum(info);
		writeUserBlock(1,info,sizeof((*info)));
	}
}
